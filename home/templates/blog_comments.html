{% extends 'base.html' %}

{% block title %} Blog - {{ post.title }} {% endblock %}


{% block body %}
{% load humanize %}
<div class="container w-75 my-4">
    <h2 class="blog-post-title">{{ post.title }}</h2>
    <p class="blog-post-category"><strong>Category:</strong> {{ post.category.name }}</p>
    
    <div class="media">
        {% if post.author.profile.image %}
        <img class="mr-3 rounded-circle" src="{{ post.author.profile.image.url }}" width="50px" height="50px" alt="image">
        {% endif %}
        <div class="media-body">
            <h5 class="mt-0">
                <a href="/user_profile/{{ post.author.id }}/">{{ post.author }}
                    {% if user.is_authenticated %}
                    {% if user.id == post.author.id %}
                    <small><a href="/edit_blog_post/{{ post.slug }}/" class="edit btn btn-warning">Edit Blog Post</a></small>
                    {% endif %}
                    {% endif %}
                </a></h5>
            <p>{{ post.dateTime }}</p>
        </div>
    </div>

    <br>
    <img class="post-image" src="/media/{{ post.image }}" alt="Blog Image">
    <p class="blog-content">{{ post.content|safe }}</p>

    <hr>

    <!-- Rating Section -->
     
    <div class="rating-section">
        <h4>Average Rating:</h4>
{% if average_rating %}
    <div>
        <strong>{{ average_rating|floatformat:1 }}</strong> / 5
        <div class="rating-stars">
            {% for i in "12345"|make_list %}
                {% with i|add:0 as i %}
                    {% if average_rating >= i %}
                        <i class="fas fa-star"></i>  <!-- Full star -->
                    {% elif average_rating >= i|add:-0.5 %}
                        <i class="fas fa-star-half-alt"></i>  <!-- Half star -->
                    {% else %}
                        <i class="far fa-star"></i>  <!-- Empty star -->
                    {% endif %}
                {% endwith %}
            {% endfor %}
        </div>
    </div>
{% else %}
    <div>No ratings yet.</div>
{% endif %}


        {% if user.is_authenticated %}
        <h4>Your Rating:</h4>
        {% if user_rating %}
            <div>
                You rated: {{ user_rating.rating }} / 5
            </div>
        {% else %}
            <div>You have not rated this blog yet.</div>
        {% endif %}

        <!-- Rating Form -->
        <h4>Rate this Blog:</h4>
        <form method="POST" action="/blog/{{ post.slug }}/"> {% csrf_token %}
            <div class="form-floating">
                <select class="form-select" id="rating" name="rating" required>
                    <option value="1" {% if user_rating.rating == 1 %}selected{% endif %}>1</option>
                    <option value="2" {% if user_rating.rating == 2 %}selected{% endif %}>2</option>
                    <option value="3" {% if user_rating.rating == 3 %}selected{% endif %}>3</option>
                    <option value="4" {% if user_rating.rating == 4 %}selected{% endif %}>4</option>
                    <option value="5" {% if user_rating.rating == 5 %}selected{% endif %}>5</option>
                </select>
                <label for="rating">Rate this Blog</label>
            </div>
            <button type="submit" class="btn btn-primary mt-2">Submit Rating</button>
        </form>
        {% else %}
        <h4><a href="/login/">Login</a> to rate and comment on this blog.</h4>
        {% endif %}
    </div>

    <br>
    <div class="comments-section">
        <h2>All Comments ({{ comments.count }})</h2>
        {% for comment in comments %}
        <div class="card comment-card">
            <div class="card-header comment-card-header">
                <span>{{ comment.user }} </span><span>{{ comment.dateTime | naturaltime }}</span>
            </div>
            <div class="card-body comment-card-body">
                <h6 class="card-text">{{ comment.content }}</h6>
            </div>
        </div>
        <br>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block hero-banner %}{% endblock hero-banner %}
